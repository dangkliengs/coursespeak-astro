---
import Layout from "../../layouts/Layout.astro";
import { getDealById, readDeals } from "../../lib/store";
import DealPage from "../../components/DealPage";

export async function getStaticPaths() {
  const allDeals = await readDeals();
  return allDeals.map((deal) => ({
    params: { id: deal.id },
    props: { deal },
  }));
}

const { deal } = Astro.props;

const allDeals = await readDeals();
const relatedDeals = allDeals
    .filter((d) => d.id !== deal.id && d.category === deal.category)
    .slice(0, 4);
---

<Layout title={`${deal.title} | [diskon] Udemy Coupons`} description={deal.description}>
    {
        /* We pass client:load to ensure interactivity (tabs, hydration) works immediately */
    }
    <DealPage client:load deal={deal} relatedDeals={relatedDeals} />
</Layout>
